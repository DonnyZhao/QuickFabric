# Define environment
dist: xenial # Ubuntu 16.04


# Specify which branches to build using a safelist
branches:
  only:
  - master
  - develop

language: python

# Install dependencies
before_install:
  - wget https://releases.hashicorp.com/terraform/"$tf_version"/terraform_"$tf_version"_linux_amd64.zip
  - unzip terraform_"$tf_version"_linux_amd64.zip
  - sudo mv terraform /usr/local/bin/
  - rm terraform_"$tf_version"_linux_amd64.zip


jobs:
  include:
    - language: python
      python: 3.7
      script:
      - Backend/run_test.sh

    - language: java
      env: 
      - MYSQL_PASSWORD="test"
      - AES_SECRET_KEY="test"
      script:
      - cd Middleware && mvn test  
    # Terraform Plan
    # Plan only on pull requests.
    - stage: terraform plan
      # Only run terraform validate, fmt and plan state if within a pull request
      if: type IN (pull_request)
      script:
        - echo "Executing Terraform Plan on pull request code"
        - terraform init 
        - terraform fmt -check
        - terraform validate 
